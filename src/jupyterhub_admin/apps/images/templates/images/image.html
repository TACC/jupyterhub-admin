{% extends "base.html" %}
{% load static %}
{% block title %} Workbench {% endblock %}
{% block head_extra %}
  <base href="{% url 'main:index' %}">
{% endblock %}
{% block styles %}
  <link rel="stylesheet" href="">
  <link rel="stylesheet" href="">
{% endblock %}
{% block content %}
  <h3>
    JupyterHub Image Configuration
  </h3>
  {% if error == True %}
    <h4>
      {{ message }}
    </h4>
  {% else %}
    <h4>{{ message }}</h4>
    <div class="form-group" for="display_name">
      <label>Display Name</label>
      <input 
        id="display_name"
        class="form-control"
        type="text"
        value="{{ image.display_name }}"
        placeholder="Display name for the image"/>
    </div>
    <div class="form-group" for="image_name">
      <label>Image Name</label>
      <input
        id="image_name"
        class="form-control"
        type="text"
        value="{{ image.name }}"
        placeholder="DockerHub image name" />
    </div>
    <button type="submit" class="btn btn-primary" id="submitImageButton">Submit</button>
    <div class="spinner-border" role="status" id="submitImageSpinner">
      <span class="sr-only">Loading...</span>
    </div>
    <div id="submitImageError">
      Error trying to save image configuration
    </div>
  {% endif %}
{% endblock %}
{% block scripts %}
<script>
  function imageSubmitSuccess(data, textStatus, jqXHR) {
    window.location.reload();
  }
  function imageSubmitFailure(jqXHR, textStatus, errorThrown) {
    $("#imageSubmitError").show();
  }
  $(document).ajaxSend(function() {
    $("#submitImageSpinner").show();
    $("#submitImageError").hide();
    $("#submitImageButton").prop("disabled", true);
  });
  $(document).ajaxStop(function() {
    $("#submitImageSpinner").hide();
    $("#submitImageButton").prop("disabled", false);
  })
  $(document).ready(function() {
    $("#submitImageSpinner").hide();
    $("#submitImageError").hide();
    $("#submitImageButton").click(function() {
      $.ajax(
        "{% url 'images:api' %}",
        {
          method: 'POST',
          headers: {'X-CSRFToken': '{{ csrf_token }}'},
          data: {
            image_name: $("#image_name").val(),
            display_name: $("#display_name").val(),
            index: "{{ index }}"
          },
          success: imageSubmitSuccess,
          error: imageSubmitFailure
        }
      )
    });
  });
</script>
{% endblock %}
